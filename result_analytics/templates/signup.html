{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load staticfiles %}
{% block title%}Sign Up{% endblock %}
{% block home_link%}
<a href="{% url 'photobox_home' %}">photobox</a>
{% endblock %}

{% block content %}
 <div class="col-md-6 center-block login" style="margin-top: 45px;">
        <div class="panel panel-default" style="padding: 10px 25px;" >
            <div class="sub-panel" style="text-align: center; font-size: 1.2em;">
                <h3 style="color: #1e3c72;"><strong>Sign Up</strong></h3>
            </div>
            <div class="panel-body">
                <form method= 'post'>{% csrf_token %}
                    <div class="form-group">
                        <label for="id_institution">Institution</label>
                        <select name="institution" id="id_institution" class="form-control">
                            {% for institution in institutions %}
                            <option value="{{institution.id}}">{{institution}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="id_user_type">User Type</label>
                        <select name="user_type" id="id_user_type" class="form-control">
                            <option value="student">Student</option>
                             <option value="lecturer">Lecturer</option>
                             <option value="admin">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group" id="id_mapper">
                        <label for="id_map">Student Reg Mapper</label>
                        <input type="text" name="map" id="id_map" class="form-control" placeholder="Reg Map" style="text-align: center;" required><span style="position: absolute; top: 280px; left: 73px; font-size: 16px;" onclick="show_mapper()" data-toggle="tooltip" data-placement="right" title="A reg mapper maps your registration number to a unique key that is randomly generated by our hash algorithm. If you don't have a reg map yet, click here to generate one now"><i class="icons icons-sm icons-info"></i></span>
                    </div>
                    <div class="form-group">
                        <label for="id_reg">Registration Number</label>
                        <input type="text" name="reg_number" id="id_reg" class="form-control" placeholder="Reg Number e.g ACME/2022/12" required>
                    </div>
                    <div class="form-group">
                        <button id="id_continue" type="submit" class="btn btn-sm custom-btn btn-block"> Continue</button>
                    </div>
                </form>
            </div> 
        </div>
        <div id="mapper" class="panel" style="display: none; position: absolute; bottom: 100px; left: -200px; width: 250px; border: 1px solid #1e3c72; border-radius: 4px; box-shadow: 1px 2px 4px rgba(0,0,0,0.08), 1px 2px 6px rgba(0,0,0,0.1);">
            <div style="border-bottom: 1px solid; padding: 0 10px; text-align: center;">
                <h4><strong>Generate a Reg Mapper</strong></h4>
            </div>
            <div class="sub-panel" style="padding: 10px;">
                <form id="frm_generator" method="GET" action="">
                    <div class="form-group">
                        <input type="text" name="short_code" id="id_short_code" class="form-control input-sm" placeholder="Short School Code e.g OAU">
                    </div>
                    <div class="form-group">
                        <input type="text" name="reg_number" id="id_reg_number" class="form-control input-sm" placeholder="Reg/Matriculation Number e.g 2021/ACE/XXX">
                    </div>
                    <div class="form-group">
                        <button  type="search" class="btn btn-sm btn-block btn-primary">Generate</button>
                    </div>
                </form>
            </div>
        </div>
<div class="new-signup">
            <div style="margin-bottom: 10px;">
                <h5 style="margin-bottom: 0;">Already have an Account?   <a href="{% url 'result_login' %}" style="font-size: 14px; color: #1e3c72;"><strong>Log In</strong></a></h5> 
            </div>
            <div>
                <h3>{{response}}</h3>
            </div>
        </div>          
    </div>
{% endblock %}

{% block extrajs %}
<script>
    $('#id_user_type').change(function() {
        if($('#id_user_type').val() == 'lecturer' || $('#id_user_type').val() == 'admin'){
        $('#id_mapper').hide('fade')
        $('#id_reg').hide('fade');
        }else{
            $('#id_mapper').show('fade');
            $('#id_reg').show('fade')
        }
    });

    var is_visible = false;
    function show_mapper() {
        if(!is_visible) {
            $('#mapper').show('fade').css('display', 'block');
            is_visible = true;
        }
        else {
            $('#mapper').css('display', 'none').hide('fade');
            is_visible = false;
        }
    }    

    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip(); 
    });
</script>
<script>
    var url = "{% url 'students:mapper-json' %}";

    function generate(path) {
        $.getJSON(path, function(data){
            console.log(data['map_code']);
            $('#id_map').val(data['map_code']);
            $('#id_reg').val($('#id_reg_number').val());
            $('#id_map').css('text-align', 'center');
        })
    }

    $('#frm_generator').submit(function(e){
        e.preventDefault();
        generate(url + "?short_code=" + $('#id_short_code').val() + "&reg_number=" + $('#id_reg_number').val());
        show_mapper();
    })
</script>
{% endblock %}