{% extends "employees/employees.html" %}
{% load search_tags payroll_tags humanize %}

{% block title %}{{ employee.first_name|capfirst }} Pay Information{% endblock %}

{% block extrahead %}
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.form.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.highlightFade.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/plugins/toggleRows.js"></script>
<script type="text/javascript">
<!--
    $(function() {
        $('.fg-button').each(function() {
            $(this).menu({
                content: $(this).next().html(),
                showSpeed: 250
            });
        });

        /*$('.change-status-form').changeStatus({
            target: "tr.payment-history",
            confirmSelectors: "button.reject, button.cancel",
            confirmMessage: "Really %(action)s this loan?"
        });*/

        $('tr.edit-formula').toggleRows({
            trigger: 'a.toggle-formula'
        });

        $('.formula-form').ajaxForm({
             dataType: 'json',
             success: function(data){
               $('.value_' + data.formula).html(data.value);
               $('.toggle-button').removeClass('toggle-button');
               $('#formula_' + data.formula).hide();

               $('table.borderless td').css({'border': 'none'});
             },
             error: function(xhr, textStatus, error){
               //console.info(textStatus);
               alert(xhr.responseText);
             }
        });
    })
//-->
</script>
<style type="text/css">
<!--
    .no-top-border { border-top: none }
    .toggle-left, .toggle-right, .toggle-button {
        background-color: #fff;
        border: 1px solid #bbb;
    }
    tr.even .toggle-button,
    .show-current-row tr.odd:hover .toggle-button,
    .show-current-row tr.even:hover .toggle-button { background-color: #fff }
    .toggle-left { border-right: none }
    .toggle-right { border-left: none; border-top: none }
    .toggle-button { border-bottom: none }
-->
</style>
{% endblock %}

{% block breadcrumbs %}
<a href="{% url 'employees_list' %}">All employees</a> &raquo;
<a href="{{ employee.get_absolute_url }}">{{ employee.full_name }}</a> &raquo; 
Pay Information
{% endblock %}

{% block content %}
<h2>{{ employee.full_name|title }}'s Pay Information</h2>
<div style="margin-top: 25px;">
    <table cellspacing="0" class="drop-shadow show-current-row borderless" style="width: 60%">
        <thead>
            <tr>
                <th scope="col">Pay item</th>
                <th scope="col">Type</th>
                <th scope="col">Formula</th>
                <th scope="col">Value</th>
                <th scope="col">&nbsp;</th>
            </tr>
        </thead>
        <tbody>
            {% for pay_formula in values %}
                <tr class="{% cycle 'odd' 'even' as rowcolors %}">
                    <td>{{ pay_formula.0.payitem.name }}</td>
                    <td>{{ pay_formula.0.payitem.get_category_display }}</td>
                    <td class="value_{{ pay_formula.0.pk }}">{% formula_value employee pay_formula.0 %}</td>
                    {% if pay_formula.0.can_override %}
                        <td class="value_{{ pay_formula.0.pk }}">{% formula_value employee pay_formula.0 %}</td>
                    {% else %}
                        <td>{{ pay_formula.1|floatformat:"2"|intcomma }}</td>
                    {% endif %}
                    <td style="text-align: center">
                        {% if pay_formula.0.can_override %}
                          <a href="#formula_{{ pay_formula.0.pk }}" class="toggle-formula" title="Override Formula">override</a>
                        {% endif %}
                    </td>
                </tr>
                {% if pay_formula.0.can_override %}
                <tr id="formula_{{ pay_formula.0.pk }}" class="edit-formula">
                    <td colspan="4" class="toggle-left">
                        {% with loan.get_status_display as loan_status %}
                        <div>
                            <form method="get" id="form_{{ pay_formula.0.pk }}" class="formula-form no-frame no-margin" action="{% url 'employees_override_formula' employee_id=employee.id formula_id=pay_formula.0.id %}">
                                <div>
                                    {% comment %}
                                    <input type="text" name="new_value" value="{% formula_value employee pay_formula %}" style="display: inline;" />
                                    {% endcomment %}
                                    <input type="text" name="new_value" value="0" style="display: inline;" />
                                    <input type="submit" value="save {{ pay_formula.0.payitem.name }}" />
                                </div>
                            </form>
                        </div>
                        {% endwith %}
                    </td>
                    <td class="toggle-right">&nbsp;</td>
                </tr>
                {% endif %}
            {% empty %}
            <tr>
                <td colspan="8">There are no formulae to display.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% paginate %}
{% endblock %}
